# intro

updated on 20240805

# ZKC

contract address: 0x862df6b2346463039589216fb84b4618b76f2b4e8bd479555863d8ea51606501

# Step

- npm start

repo link:
https://github.com/MartinYeung5/20240623_aptos_frontend

# References

- https://aptos.dev/en/build/sdks/ts-sdk/building-transactions

# status

- done

# Error

- 1,
  is out of range: [0, 18446744073709551615]

# Record

## 20240805

#### How to use Aptos Indexer API?

https://developer.nodit.io/reference/how-to-use-aptos-indexer-api
using NODIT: Connecting Aptos Indexer API to Hasura Public Cloud

1. copy Aptos Indexer API endpoint (in NODIT)
   https://nodit.lambda256.io/1722839213462388684/overview
2. create account (Hasura Public Cloud) login by google account
   https://cloud.hasura.io/public/graphiql
3. paste the API endpont to the "connect to endpoint"
   testing successful

4. APTOS - Set up for Tutorials
   https://developer.nodit.io/docs/set-up-for-tutorials

5. NODE API usage (重要)
   https://developer.nodit.io/reference/aptos_getaccount

can get address 所創建的 contract, counter 係紀錄 contract 數量, 0 表示目前是 0 個
https://developer.nodit.io/reference/aptos_getaccountresources

6. studying multisig
   Error/issue:
   https://developer.nodit.io/reference/aptos_submittransaction
   Any one can explain more details of Multi Ed25519 Signature in Aptos-Node API-Transaction-Submit transaction ?

## 20240808

Explanation of Multi Ed25519 Signature usage:

1. Overview of Multi Ed25519 Signature:
   Multi Ed25519 Signature is a variant of the Ed25519 algorithm that supports multiple signatures. This allows multiple signatures to be combined to authenticate a single transaction. Using multiple signatures enhances security, as the transaction must be approved by several parties before being submitted to the network.

2. Structure of Multi Ed25519 Signature:
   The Multi Ed25519 Signature consists of the following elements:

Public Keys: A list of all public keys participating in the signature.
Threshold: The minimum number of signatures required for the transaction to be valid.
Signatures: The signatures generated by each participant using their private key.
Bitmap: A bitmap indicating the index of the public keys included in the signatures.

3. Applying Multi Ed25519 Signature to a transaction:
   To submit a transaction to an Aptos node using a Multi Ed25519 Signature, follow these steps:

3-1. Signature Generation:
Prepare the transaction data.
Each participant signs the transaction data using their private key.
Collect the signatures to form the multi-signature structure.

3-2. Transaction Creation:
Include the Multi Ed25519 Signature structure in the transaction body.
Set the public key list, signature list, bitmap, and threshold.

3-3. Transaction Submission:
Submit the created transaction through the Aptos node API.
Use the TransactionSubmit endpoint to submit the transaction, including the transaction body with the Multi Ed25519 Signature.

4. Example:
   Here is a simple example of submitting a transaction with a Multi Ed25519 Signature using the Aptos node API:

Json

{
"type": "user_transaction",
"sender": "0x123...",
"sequence_number": "10",
"payload": {
"type": "script_function_payload",
"function": "0x1::aptos_account::transfer",
"type_arguments": [],
"arguments": ["0x456...", "1000"]
},
"signature": {
"type": "multi_ed25519_signature",
"signatures": [
{
"public_key": "0xabc...",
"signature": "0xdef..."
},
{
"public_key": "0xghi...",
"signature": "0xjkl..."
}
],
"bitmap": "3",
"threshold": 2
}
}
In this example, a transaction with two signatures included in a multi-signature structure is submitted.

This provides a basic understanding and usage of the Multi Ed25519 Signature. However, for more precise and detailed information, it is recommended to refer to the Aptos Discord channel before using it. You can get more comprehensive assistance through Aptos's official documentation and forum.

Additionally, you can easily use Aptos nodes through Nodit. To send transactions, you can utilize the API provided below:

Submit Transaction API

## 20240810

1. add GetAccount.tsx
2. error
   Argument of type 'void' is not assignable to parameter of type 'SetStateAction<null>'.ts(2345)
   solution:

- update
  const [data, setData] = useState<void | null>(null);

3. npm install axios
4. npm i dotenv

20240815
https://aptos.guide/en/build/guides/first-multisig#step-62-submit-the-multisig-transaction

20240817
https://aptos.guide/en/build/sdks/ts-sdk/building-transactions/multi-agent-transactions

## 20240818

中文版(old)
https://aptos.web3doc.top/tutorials/your-first-transaction/
英文版(old)
https://aptos.dev/en/build/guides/first-transaction

when use :
const aliceSenderAuthenticator = aptos.transaction.sign({
signer: alice,
transaction,
});

error:
cannot be used as a JSX component.
Its type '() => void' is not a valid JSX element type.
Type '() => void' is not assignable to type '(props: any, deprecatedLegacyContext?: any) => ReactNode'.
Type 'void' is not assignable to type 'ReactNode'.

## 20240819

when try many request to get fund:
error msg:
core.ts:100 Uncaught (in promise) AptosApiError: Request to [Faucet]: POST https://faucet.testnet.aptoslabs.com/fund failed with: {"message":"Request rejected by 1 checkers","error_code":"Rejected","rejection_reasons":[{"reason":"IP 3.35.185.78 has reached the maximum allowed number of requests per day: 10","code":"IpUsageLimitExhausted"}],"txn_hashes":[]}

when try many request to get fund:
error msg:
AptosApiError: Request to [Faucet]: POST https://faucet.testnet.aptoslabs.com/fund failed with: {"message":"Request rejected by 1 checkers","error_code":"Rejected","rejection_reasons":[{"reason":"IP 223.17.140.185 has reached the maximum allowed number of requests per day: 10","code":"IpUsageLimitExhausted"}],"txn_hashes":[]}
at y (core.ts:100:1)
at async x (faucet.ts:26:1)
at async i.fundAccount (faucet.ts:34:1)
at async test2 (App.tsx:159:1)

#### question on github

https://github.com/aptos-labs/aptos-developer-discussions/discussions/369

Hi team, i tried to use aptos.transaction.sign,

The following is my code:
import { useWallet } from "@aptos-labs/wallet-adapter-react";
const { account, signAndSubmitTransaction } = useWallet();
const owner1 = account;

const bobSenderAuthenticator = aptos.transaction.sign({
signer: owner1 ,
transaction,
});

version:
"@aptos-labs/ts-sdk": "^1.26.0",
"@aptos-labs/wallet-adapter-react": "^3.4.3",

When i get the account data from wallet, i can't use in aptos.transaction.sign.
The console showed the error msg:
TypeError: a.signTransactionWithAuthenticator is not a function

if i use:
let owner2 = Account.generate();
const bobSenderAuthenticator = aptos.transaction.sign({
signer: owner2 ,
transaction,
});

results:
no error

Therefore, how can i change the account type to Ed25519Account ?

solution:
const privateKey = new Ed25519PrivateKey(process.env.REACT_APP_PRIVATE_KEY!);
const ownerAccount = Account.fromPrivateKey({privateKey});
const aliceSenderAuthenticator = aptos.transaction.sign({
signer: ownerAccount,
transaction,
});

## 20240821
- npm i dotenv

## 20240822
https://github.com/aptos-labs/aptos-developer-discussions/discussions/372

## 20240901
Actually, i can create the accounts on-chain, but i want to get general user's account, not create the new one.
for example, user Bob log in the platform with wallet, and only want to take the sign action, how can i do ? 

situation:
* user Bob login with wallet (Bob already has wallet on chain)
* make the sign action for his document (already uploaded to blockchain or at same time)
* Bob can see owner's sign record with specific document 
* Bob can sign the same document

why error SENDING_ACCOUNT_DOES_NOT_EXIST ?

updated:
      console.log("owner1 = " + owner1Address);
      await aptos.fundAccount({accountAddress: owner1Address, amount: 100_000_000,});
      let bob = Account.generate();
      await aptos.fundAccount({accountAddress: bob.accountAddress, amount: 100_000_000,});
      console.log("bob = " + bob.accountAddress);
      
results:
solved successfully!


* when the code go the step 5 "Wait for results", it shows the error msg:
error:
transaction.ts:207 Uncaught (in promise) T: Transaction 0x89f6e803088595604e94a56fbf91f4784fd5bd0220a15e21a288fcc40e9ad67c failed with an error: Execution failed with miscellaneous error and no status code

why?
shoud use WITH YOUR MULTI AGENT MOVE ENTRY FUNCTION

example contract
https://github.com/aptos-labs/aptos-ts-sdk/blob/main/tests/move/transfer/sources/script_two_by_two.move

* setup new move contract
how to do ?
- aptos init
- aptos account fund-with-faucet --account default
- aptos move compile --named-addresses launchpad=default
- aptos move test --named-addresses launchpad=default
- aptos move publish --named-addresses launchpad=default

// 546db4d367eaae5232e5326cf56e054c33faccd2413eaa9d00e2c06628815952::ContractDatabase

results:
"Result": {
    "transaction_hash": "0x5ddb71a5ccb68dbf8a715bb60044c9e304db9e4c12d00f419515ed596bddec1b",        
    "gas_used": 255,
    "gas_unit_price": 100,
    "sender": "546db4d367eaae5232e5326cf56e054c33faccd2413eaa9d00e2c06628815952",
    "sequence_number": 2,
    "success": true,
    "timestamp_us": 1725167734554803,
    "version": 5930015070,
    "vm_status": "Executed successfully"
  }

  https://api.testnet.aptoslabs.com/v1/transactions/by_hash/b0aec3425e59a4c51ed75f9990d9c08b9160b50c424740ac5aea2c2e61eedf64

## 20240902
合约是这样的，在 devnet 上
https://explorer.aptoslabs.com/account/0x7676ac902e9ef65bbd089e116f92e91b95bf8d76586915c2caef71941a33d1b4/modules/code/mult/mult_signer?network=devnet

#### 問題1
想問一下, std::signer 和 aptos_framework::signer 有什麼差別?

## 20240903
* update move contract
- aptos move compile --named-addresses launchpad=default
- aptos move publish --named-addresses launchpad=default

{
  "Result": [
    "546db4d367eaae5232e5326cf56e054c33faccd2413eaa9d00e2c06628815952::ContractDatabase"
  ]
}

針對signer部分, 如果我是用 const { account} = useWallet(); 從這方式獲得user account, 可以怎樣轉為signer認可的格式?
我指的signer是下面的signer格左:
const aliceSenderAuthenticator = aptos.transaction.sign({
        signer: ownerAccount,
        transaction,
      });

## 20240904
Type 'AccountInfo' is missing the following properties from type 'Account$1


Error:
Property 'signTransaction' does not exist on type 'Aptos', 

Error:
Property 'signMessage' does not exist on type 'Aptos'

why?
因為不是用在這個aptos
const config = new AptosConfig({ network: Network.TESTNET });
const aptos = new Aptos(config);
因为 账户的私钥在被钱包保存，不能用 aptos ts sdk 的方式签名，需要用钱包导出的接口签名


參考例子
* https://github.com/aptos-labs/aptos-wallet-adapter/blob/ee95b8b3cd9eff0d7ebec1f3ee8017d222fe0e15/apps/nextjs-example/src/components/transactionFlows/SingleSigner.tsx#L114

concept 整理:
1. 獲得transaction hash
2. owner 去 sign
3. 指定user/中介/負責做驗證的人 去 sign

## 20240924
update App.tsx
```
const {
    connected,
    account,
    network,
    signAndSubmitTransaction,
    signMessageAndVerify,
    signMessage,
    signTransaction,
  } = useWallet();
```

重要:
https://github.com/aptos-labs/aptos-wallet-adapter/blob/ee95b8b3cd9eff0d7ebec1f3ee8017d222fe0e15/apps/nextjs-example/src/components/transactionFlows/MultiAgent.tsx#L18

const response = await submitTransaction({
        transaction: transactionToSubmit,
        senderAuthenticator: senderAuthenticator,
        additionalSignersAuthenticators: [secondarySignerAuthenticator],
      });
但有error:
App.tsx:171 AptosApiError: Request to [Fullnode]: POST https://api.testnet.aptoslabs.com/v1/transactions failed with: {"message":"Invalid transaction: Type: Validation Code: INVALID_AUTH_KEY","error_code":"vm_error","vm_error_code":2}
    at y (core.ts:100:1)
    at async B (transactionSubmission.ts:262:1)
    at async submitTransaction (WalletProvider.tsx:145:1)
    at async onSubmitTransaction (App.tsx:163:1)


const response = await aptos.transaction.submit.multiAgent({
        transaction: transactionToSubmit,
        senderAuthenticator: senderAuthenticator,
        additionalSignersAuthenticators: [secondarySignerAuthenticator],
      });

App.tsx:173 AptosApiError: Request to [Fullnode]: POST https://api.testnet.aptoslabs.com/v1/transactions failed with: {"message":"Invalid transaction: Type: Validation Code: INVALID_AUTH_KEY","error_code":"vm_error","vm_error_code":2}
    at y (core.ts:100:1)
    at async B (transactionSubmission.ts:262:1)
    at async onSubmitTransaction (App.tsx:163:1)

## 20240925
* update MultiAgent.tsx

'0x780073548409f45d6fec191ef100eeaa9711fa74b0a8980aa0c76e9c2b4b07ab'